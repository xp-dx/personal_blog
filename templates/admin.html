<!DOCTYPE html>
<html lang="en">
<head>
    <!-- <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <link href="{{ url_for('static', path='/css/style.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', path='/css/admin.css') }}" rel="stylesheet">
    <title>Admin panel</title>
</head>
    
<body>
    <div class="main_card">
    <header>
        <h1>Personal Blog</h1>
        <a href="/new">+ Add</a>
    </header>
    
    <main>
        <div class="articles_card">
            {% for article in articles %}
            <div class="article_container">
                <span class="article_title">
                  <b>{{ article.title.title() }}</b>
                </span>
                
                <div class="links">
                    <a href="/edit/{{ article.id }}">Edit</a>
                    <a href="/delete/{{ article.id }}" class="delete-link" data-article-id="{{ article.id }}">Delete</a>
                </div>
                
                <!-- <div class="link_container">
                    <b>{{ article.title.title() }}</b>d
                    <a href="/edit/{{ article.id }}"></a>
                </div> -->
            </div>
            {% endfor %} 
        </div>
        <!-- <script></script> -->
        <!-- <script src="{{ url_for('static', path='/js/admin.css') }}"></script> -->
        <!-- <link href="{{ url_for('static', path='/js/admin.css') }}" rel="stylesheet"> -->
    </main>
    </div>
    <script>
        document.querySelectorAll('.delete-link').forEach(link => {
            link.addEventListener('click', async event => {
              event.preventDefault();
              const articleId = link.dataset.articleId;
              if (confirm('Are you sure you want to delete this article?\nThis action cannot be undone.')) {
                const response = await fetch(`/delete/${articleId}/`, {
                  method: 'DELETE',
                });
                if (response.ok) {
                  link.closest('.article_container').remove();
                  // document.querySelector('.article_container').remove();
                  // handle success
                } else {
                  console.error('Article deletion error:', response.status, response.statusText);
                  if (response.status == 404){
                    alert('Error deleting article. Article not found.');
                  }
                  alert('Error deleting article. More details in the console.');
                  // handle error
                  }
              }
            });
          });
    </script>
</body>
</html>